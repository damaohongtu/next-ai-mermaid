# é¡¹ç›®æž¶æž„è¯´æ˜Ž

## ðŸ“ æž¶æž„æ¦‚è§ˆ

æœ¬é¡¹ç›®é‡‡ç”¨**å‰åŽç«¯åˆ†ç¦»**æž¶æž„ï¼Œå‰ç«¯ä½¿ç”¨ React + Vite æž„å»ºå•é¡µåº”ç”¨ï¼ŒåŽç«¯ä½¿ç”¨ FastAPI æä¾› RESTful API æœåŠ¡ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      HTTP/JSON      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚                  â”‚
â”‚  React Frontend â”‚                     â”‚  FastAPI Backend â”‚
â”‚   (Port 3000)   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   (Port 8000)    â”‚
â”‚                 â”‚      API Response   â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ API Call
                                               â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚  DeepSeek AI â”‚
                                        â”‚     API      â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ—ï¸ æŠ€æœ¯æž¶æž„

### å‰ç«¯æž¶æž„

```
Frontend (React + TypeScript)
â”œâ”€â”€ Components Layer
â”‚   â”œâ”€â”€ ChatInterface     # èŠå¤©ç•Œé¢
â”‚   â”œâ”€â”€ MermaidRenderer   # å›¾è¡¨æ¸²æŸ“
â”‚   â””â”€â”€ CodeEditor        # ä»£ç ç¼–è¾‘å™¨
â”‚
â”œâ”€â”€ Services Layer
â”‚   â””â”€â”€ geminiService     # API è°ƒç”¨æœåŠ¡
â”‚
â”œâ”€â”€ Utils Layer
â”‚   â””â”€â”€ mermaidUtils      # å·¥å…·å‡½æ•°
â”‚
â””â”€â”€ State Management
    â””â”€â”€ Local State (useState)
```

**æŠ€æœ¯é€‰åž‹ç†ç”±**ï¼š
- **React 19**: æœ€æ–°ç‰¹æ€§ï¼Œæ›´å¥½çš„æ€§èƒ½
- **TypeScript**: ç±»åž‹å®‰å…¨ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯
- **Vite**: æžé€Ÿçš„å¼€å‘ä½“éªŒå’Œæž„å»ºé€Ÿåº¦
- **Mermaid.js**: ä¸“ä¸šçš„å›¾è¡¨æ¸²æŸ“åº“

### åŽç«¯æž¶æž„

```
Backend (FastAPI + Python)
â”œâ”€â”€ API Layer (main.py)
â”‚   â”œâ”€â”€ CORS Middleware
â”‚   â”œâ”€â”€ Routers
â”‚   â””â”€â”€ Exception Handlers
â”‚
â”œâ”€â”€ Router Layer (routers/)
â”‚   â””â”€â”€ mermaid.py         # Mermaid ç›¸å…³è·¯ç”±
â”‚
â”œâ”€â”€ Service Layer (services/)
â”‚   â””â”€â”€ ai_service.py      # AI æœåŠ¡é€»è¾‘
â”‚
â””â”€â”€ Config Layer (config.py)
    â””â”€â”€ Settings Management
```

**æŠ€æœ¯é€‰åž‹ç†ç”±**ï¼š
- **FastAPI**: é«˜æ€§èƒ½ï¼Œè‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£ï¼Œå¼‚æ­¥æ”¯æŒ
- **Pydantic**: å¼ºå¤§çš„æ•°æ®éªŒè¯
- **OpenAI SDK**: DeepSeek API å…¼å®¹ OpenAI æŽ¥å£

## ðŸ” å®‰å…¨è®¾è®¡

### API å¯†é’¥ä¿æŠ¤

```
âŒ ä¸å®‰å…¨çš„æ–¹å¼ï¼ˆæ—§æž¶æž„ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚
â”‚  (Frontend) â”‚  â† API Key æš´éœ²åœ¨å‰ç«¯ä»£ç ä¸­ âŒ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ Direct API Call with exposed key
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DeepSeek AI â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… å®‰å…¨çš„æ–¹å¼ï¼ˆæ–°æž¶æž„ï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚
â”‚  (Frontend) â”‚  â† æ—  API Key âœ…
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ API Request (no key)
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Backend   â”‚  â† API Key å­˜å‚¨åœ¨æœåŠ¡å™¨ âœ…
â”‚   (FastAPI) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ API Call with server key
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DeepSeek AI â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CORS é…ç½®

åŽç«¯é…ç½®äº†ä¸¥æ ¼çš„ CORS ç­–ç•¥ï¼Œåªå…è®¸ç‰¹å®šçš„å‰ç«¯åŸŸåè®¿é—®ï¼š

```python
allow_origins=[
    "http://localhost:3000",
    "http://127.0.0.1:3000",
    "http://localhost:5173",
    "http://127.0.0.1:5173"
]
```

## ðŸ“Š æ•°æ®æµ

### ç”¨æˆ·è¯·æ±‚æµç¨‹

```
1. User Input
   â†“
2. Frontend (ChatInterface)
   â”œâ”€â”€ æ”¶é›†ç”¨æˆ·è¾“å…¥å’ŒåŽ†å²è®°å½•
   â””â”€â”€ è°ƒç”¨ geminiService
   â†“
3. Frontend Service Layer
   â”œâ”€â”€ æž„é€ è¯·æ±‚ä½“
   â””â”€â”€ å‘é€ POST /api/generate-diagram
   â†“
4. Backend Router (mermaid.py)
   â”œâ”€â”€ æŽ¥æ”¶è¯·æ±‚
   â”œâ”€â”€ éªŒè¯æ•°æ® (Pydantic)
   â””â”€â”€ è°ƒç”¨ ai_service
   â†“
5. Backend Service (ai_service.py)
   â”œâ”€â”€ æž„é€  AI prompt
   â”œâ”€â”€ è°ƒç”¨ DeepSeek API
   â””â”€â”€ è¿”å›žç”Ÿæˆç»“æžœ
   â†“
6. Backend Router
   â”œâ”€â”€ åŒ…è£…å“åº”
   â””â”€â”€ è¿”å›ž JSON
   â†“
7. Frontend Service
   â”œâ”€â”€ è§£æžå“åº”
   â””â”€â”€ è¿”å›žå†…å®¹
   â†“
8. Frontend Component
   â”œâ”€â”€ æ›´æ–° UI
   â”œâ”€â”€ æ·»åŠ åˆ°åŽ†å²è®°å½•
   â””â”€â”€ æ¸²æŸ“ Mermaid å›¾è¡¨
```

### æ•°æ®æ ¼å¼

**è¯·æ±‚æ ¼å¼**ï¼š
```typescript
{
  prompt: string,
  history: [
    { role: "user", content: "..." },
    { role: "assistant", content: "..." }
  ]
}
```

**å“åº”æ ¼å¼**ï¼š
```typescript
{
  content: string,     // Mermaid ä»£ç 
  success: boolean,
  message: string      // çŠ¶æ€æ¶ˆæ¯
}
```

## ðŸ—‚ï¸ ç›®å½•ç»“æž„

```
next-ai-mermaid/
â”œâ”€â”€ backend/                    # åŽç«¯æœåŠ¡
â”‚   â”œâ”€â”€ main.py                # FastAPI å…¥å£
â”‚   â”œâ”€â”€ config.py              # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ run.py                 # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ requirements.txt       # Python ä¾èµ–
â”‚   â”œâ”€â”€ .env                   # çŽ¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ï¼‰
â”‚   â”œâ”€â”€ .env.example           # çŽ¯å¢ƒå˜é‡æ¨¡æ¿
â”‚   â”œâ”€â”€ .gitignore             # Git å¿½ç•¥æ–‡ä»¶
â”‚   â”œâ”€â”€ README.md              # åŽç«¯æ–‡æ¡£
â”‚   â”œâ”€â”€ routers/               # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ mermaid.py         # Mermaid è·¯ç”±
â”‚   â””â”€â”€ services/              # ä¸šåŠ¡é€»è¾‘
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ ai_service.py      # AI æœåŠ¡
â”‚
â”œâ”€â”€ components/                 # React ç»„ä»¶
â”‚   â”œâ”€â”€ ChatInterface.tsx      # èŠå¤©ç•Œé¢
â”‚   â”œâ”€â”€ MermaidRenderer.tsx    # å›¾è¡¨æ¸²æŸ“
â”‚   â””â”€â”€ CodeEditor.tsx         # ä»£ç ç¼–è¾‘å™¨
â”‚
â”œâ”€â”€ services/                   # å‰ç«¯æœåŠ¡
â”‚   â””â”€â”€ geminiService.ts       # API è°ƒç”¨æœåŠ¡
â”‚
â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ mermaidUtils.ts        # Mermaid å·¥å…·
â”‚
â”œâ”€â”€ App.tsx                     # ä¸»åº”ç”¨ç»„ä»¶
â”œâ”€â”€ main.tsx                    # åº”ç”¨å…¥å£
â”œâ”€â”€ index.html                  # HTML æ¨¡æ¿
â”œâ”€â”€ vite.config.ts             # Vite é…ç½®
â”œâ”€â”€ tsconfig.json              # TypeScript é…ç½®
â”œâ”€â”€ package.json               # å‰ç«¯ä¾èµ–
â”œâ”€â”€ .env.local                 # å‰ç«¯çŽ¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ï¼‰
â”œâ”€â”€ .env.example               # å‰ç«¯çŽ¯å¢ƒå˜é‡æ¨¡æ¿
â”‚
â”œâ”€â”€ start-dev.bat              # Windows å¯åŠ¨è„šæœ¬
â”œâ”€â”€ start-dev.sh               # Linux/Mac å¯åŠ¨è„šæœ¬
â”œâ”€â”€ test-setup.bat             # çŽ¯å¢ƒæ£€æŸ¥è„šæœ¬
â”‚
â”œâ”€â”€ README.md                  # é¡¹ç›®è¯´æ˜Ž
â”œâ”€â”€ QUICKSTART.md              # å¿«é€Ÿå¼€å§‹
â””â”€â”€ ARCHITECTURE.md            # æž¶æž„è¯´æ˜Žï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

## ðŸ”„ å¼€å‘å·¥ä½œæµ

### æœ¬åœ°å¼€å‘

1. **åŽç«¯å¼€å‘** (`backend/`)
   - ä¿®æ”¹ä»£ç 
   - ä¿å­˜åŽè‡ªåŠ¨é‡è½½ï¼ˆuvicorn --reloadï¼‰
   - è®¿é—® http://localhost:8000/docs æµ‹è¯• API

2. **å‰ç«¯å¼€å‘** (æ ¹ç›®å½•)
   - ä¿®æ”¹ç»„ä»¶/æœåŠ¡
   - ä¿å­˜åŽæµè§ˆå™¨è‡ªåŠ¨çƒ­é‡è½½ï¼ˆVite HMRï¼‰
   - è®¿é—® http://localhost:3000 æŸ¥çœ‹æ•ˆæžœ

### æ·»åŠ æ–°åŠŸèƒ½

**åŽç«¯**ï¼š
1. åœ¨ `services/` åˆ›å»ºä¸šåŠ¡é€»è¾‘
2. åœ¨ `routers/` åˆ›å»º API ç«¯ç‚¹
3. åœ¨ `main.py` æ³¨å†Œè·¯ç”±
4. è®¿é—® `/docs` æŸ¥çœ‹è‡ªåŠ¨ç”Ÿæˆçš„ API æ–‡æ¡£

**å‰ç«¯**ï¼š
1. åœ¨ `services/` åˆ›å»º API è°ƒç”¨å‡½æ•°
2. åœ¨ `components/` åˆ›å»ºæˆ–ä¿®æ”¹ UI ç»„ä»¶
3. åœ¨ `App.tsx` ç»„åˆç»„ä»¶

## ðŸš€ éƒ¨ç½²æž¶æž„

### æŽ¨èéƒ¨ç½²æ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Vercel     â”‚  â† å‰ç«¯é™æ€ç«™ç‚¹
â”‚  (Frontend)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ API Calls
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Railway    â”‚  â† åŽç«¯ API æœåŠ¡
â”‚  (Backend)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ AI API
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DeepSeek    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å‰ç«¯éƒ¨ç½²**ï¼š
- Vercel / Netlify / GitHub Pages
- æž„å»ºå‘½ä»¤: `npm run build`
- è¾“å‡ºç›®å½•: `dist/`

**åŽç«¯éƒ¨ç½²**ï¼š
- Railway / Render / Heroku
- å¯åŠ¨å‘½ä»¤: `uvicorn main:app --host 0.0.0.0 --port $PORT`

### çŽ¯å¢ƒå˜é‡é…ç½®

**å‰ç«¯ç”Ÿäº§çŽ¯å¢ƒ**ï¼š
```bash
VITE_API_URL=https://your-backend-api.com
```

**åŽç«¯ç”Ÿäº§çŽ¯å¢ƒ**ï¼š
```bash
API_KEY=your_production_deepseek_key
HOST=0.0.0.0
PORT=8000
```

## ðŸ§ª æµ‹è¯•ç­–ç•¥

### å‰ç«¯æµ‹è¯•
- å•å…ƒæµ‹è¯•: ç»„ä»¶å’Œå·¥å…·å‡½æ•°
- é›†æˆæµ‹è¯•: API æœåŠ¡è°ƒç”¨
- E2E æµ‹è¯•: ç”¨æˆ·æµç¨‹

### åŽç«¯æµ‹è¯•
- å•å…ƒæµ‹è¯•: æœåŠ¡å±‚é€»è¾‘
- API æµ‹è¯•: ç«¯ç‚¹åŠŸèƒ½
- é›†æˆæµ‹è¯•: å®Œæ•´è¯·æ±‚æµç¨‹

## ðŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–
- âœ… Vite æž„å»ºä¼˜åŒ–ï¼ˆä»£ç åˆ†å‰²ã€Tree Shakingï¼‰
- âœ… React ç»„ä»¶æ‡’åŠ è½½
- âœ… Mermaid æŒ‰éœ€æ¸²æŸ“
- ðŸ”„ å“åº”ç¼“å­˜ï¼ˆå¾…å®žçŽ°ï¼‰
- ðŸ”„ è¯·æ±‚é˜²æŠ–ï¼ˆå¾…å®žçŽ°ï¼‰

### åŽç«¯ä¼˜åŒ–
- âœ… FastAPI å¼‚æ­¥å¤„ç†
- âœ… Pydantic æ•°æ®éªŒè¯ç¼“å­˜
- ðŸ”„ å“åº”åŽ‹ç¼©ï¼ˆå¾…å®žçŽ°ï¼‰
- ðŸ”„ Redis ç¼“å­˜ï¼ˆå¾…å®žçŽ°ï¼‰
- ðŸ”„ é€ŸçŽ‡é™åˆ¶ï¼ˆå¾…å®žçŽ°ï¼‰

## ðŸ”® æœªæ¥æ‰©å±•

### è®¡åˆ’åŠŸèƒ½
1. **ç”¨æˆ·è®¤è¯**: JWT èº«ä»½éªŒè¯
2. **å›¾è¡¨ä¿å­˜**: æ•°æ®åº“æŒä¹…åŒ–
3. **å®žæ—¶åä½œ**: WebSocket æ”¯æŒ
4. **å¤šæ¨¡åž‹æ”¯æŒ**: æŽ¥å…¥æ›´å¤š AI æ¨¡åž‹
5. **å›¾è¡¨æ¨¡æ¿**: é¢„è®¾æ¨¡æ¿åº“
6. **å¯¼å‡ºåŠŸèƒ½**: PNG/SVG/PDF å¯¼å‡º

### æž¶æž„å‡çº§
- æ•°æ®åº“å±‚ï¼ˆPostgreSQLï¼‰
- ç¼“å­˜å±‚ï¼ˆRedisï¼‰
- æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQï¼‰
- å®¹å™¨åŒ–ï¼ˆDockerï¼‰
- å¾®æœåŠ¡åŒ–ï¼ˆæ ¹æ®éœ€æ±‚ï¼‰

## ðŸ“š å‚è€ƒèµ„æ–™

- [FastAPI æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [React æ–‡æ¡£](https://react.dev/)
- [Vite æ–‡æ¡£](https://vitejs.dev/)
- [Mermaid.js æ–‡æ¡£](https://mermaid.js.org/)
- [DeepSeek API æ–‡æ¡£](https://platform.deepseek.com/api-docs/)

